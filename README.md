# 数据库词频统计工具

## 目的

脚本从数据库提取公司对账单里流水的对手方名称和用户备注，按本方ID分类。然后使用jieba分词并统计词频，生成词频字典保存至本地等待调用。api获得本方ID和查看条目作为参数，然后通过路径找到保存的词频字典，返回对应的词频。

cloudword的定时执行：使用linux的crontab命令每天定时更新一次词典

wordc_api的后台运行：可以使用supervisor配置文件在后台自动执行python flask

## 依赖

- flask_restful
- collections
- jieba_fast (在windows下请用jieba并关闭enable_paralle())
- requests
- pymysql
- pickle
- flask
- re

## cloudword.py的使用

全局参数，请按情况自行填写：

- DBPATH：数据库路径
- USER：数据库用户名
- PWD：数据库用户密码
- DB：数据库名称
- MAX_NUM=最多取多少条数据作词频统计
- MAX_FREQ=词频最多取前几
- PATH=词频字典的存储路径

词频统计处理会按照本方ID进行，每完成一个本方ID的词频统计就会重新更新存储。

在Linux系统下，请调用jieba_fast库并开启多线程模式（jieba.enable_parallel()），分词速度会更快；在Windows系统下，请调用jieba库并关闭多线程模式

## API的调用

在使用api之前，请先确保跑过一遍cloudword.py，否则api将无法使用路径提取词频字典。

请求格式：POST， json

- **/frequency**
  - 请求json样例：{“source”：”GO“，“id”：“133”，“method”：“name”} ”source“为数据库，“id”为本方ID，“method”为查看条目：“name”为查看对手方名称词频，“memo”为查看用户备注词频。
  - 返回json样例：{"上海": 1, "爱信诺": 1, "航天": 1, "信息": 1, "有限公司": 1}

## 测试

python 2.7.15+, python 3.6.5 环境下都可以

命令窗口或supervisor后台运行wordc_api.py

服务器输入curl http://127.0.0.1:5000/frequency?source=GO\&id=133,CNY\&method=name， 输出：{"code": 200, "data": {"有限公司": 3380, "广告": 619, "常州": 587, "标识": 583, "上海": 427, "常州市": 417, "江苏": 335, "科技": 296, "国际": 295, "代理": 280, "装饰": 198, "货运": 178, "通": 170, "奥兰": 154, "文化": 141, "瑞": 138, "科思": 135, "杭州": 129, "工程": 127, "传播": 124, "无锡": 122, "苏州": 111, "庞彦": 110, "分公司": 107, "设计": 107, "西安": 107, "制作": 106, "德誉": 105, "股份": 102, "有限责任": 101, "公司": 101, "物流": 99, "预算": 97, "收入": 97, "待": 96, "报解": 95, "武进区": 93, "金库": 90, "南京": 85, "策划": 84, "广告设计": 82, "国库": 80, "集中": 80, "制造": 79, "缴税": 79, "传媒": 77, "技术": 76, "金": 76, "中国": 75, "实业": 68}}。